### Additional settings not covered by Nix options
set -g renumber-windows on
set -g set-titles off
set -ag terminal-overrides ",xterm-256color:RGB"

# Prefix + Meta + l to clear terminal
bind -n C-M-l send-keys 'clear' C-m

### Vi mode copy bindings

# Search
bind-key -T copy-mode-vi / command-prompt -i -p "search down" \
  "send -X search-forward-incremental \"%%%\""
bind-key -T copy-mode-vi ? command-prompt -i -p "search up" \
  "send -X search-backward-incremental \"%%%\""

# Selection & yanking
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi y send -X copy-selection-and-cancel

### Splits and window management

bind-key v split-window -h -c "#{pane_current_path}"
bind-key s split-window -v -c "#{pane_current_path}"

# Pane zoom
bind-key z resize-pane -Z

# Break pane into new window
bind-key b break-pane -d

# Quick pane kill
bind-key X kill-pane

### Smart navigation (vim-aware)

is_vim="ps -o comm= -t '#{pane_tty}' | grep -iqE 'g?(view|n?vim)(diff)?$'"

bind-key -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind-key -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

# Copy-mode navigation
bind-key -T copy-mode-vi C-h select-pane -L
bind-key -T copy-mode-vi C-j select-pane -D
bind-key -T copy-mode-vi C-k select-pane -U
bind-key -T copy-mode-vi C-l select-pane -R

### Resizing
bind-key -n M-h if-shell "$is_vim" "send-keys M-h" "resize-pane -L 5"
bind-key -n M-j if-shell "$is_vim" "send-keys M-j" "resize-pane -D 5"
bind-key -n M-k if-shell "$is_vim" "send-keys M-k" "resize-pane -U 5"
bind-key -n M-l if-shell "$is_vim" "send-keys M-l" "resize-pane -R 5"

bind-key -T copy-mode-vi M-h resize-pane -L 5
bind-key -T copy-mode-vi M-j resize-pane -D 5
bind-key -T copy-mode-vi M-k resize-pane -U 5
bind-key -T copy-mode-vi M-l resize-pane -R 5

### Pane and window movement

# Swap panes
bind-key -n M-H swap-pane -s '{left-of}'
bind-key -n M-L swap-pane -s '{right-of}'
bind-key -n M-K swap-pane -s '{up-of}'
bind-key -n M-J swap-pane -s '{down-of}'

# Move windows left/right
bind-key < swap-window -t -1 \; previous-window
bind-key > swap-window -t +1 \; next-window

### Session/tree view

unbind-key w
bind-key w choose-tree -Zs
bind-key C-j choose-tree

### Visuals - Minimalist & Clean

set -g status-position top
set -g status-style bg=default,fg="#666666"
set -g status-left "#[fg=#888888,bold] #S #[fg=#444444]â”‚ "
set -g status-left-length 20
set -g status-right ""
set -g window-status-format "#[fg=#444444]#I #W"
set -g window-status-current-format "#[fg=#ffffff,bold]#I #W"
set -g window-status-separator "   "
set -g pane-border-style fg="#222222"
set -g pane-active-border-style fg="#444444"
set -g message-style bg="#111111",fg="#ffffff"
set -g mode-style bg="#333333",fg="#ffffff"

### Misc
setw -g monitor-activity on
set -g visual-activity off
set -g window-status-activity-style "fg=#ff6b6b"

bind-key r source-file ~/.config/tmux/tmux.conf \; display-message "tmux.conf reloaded."

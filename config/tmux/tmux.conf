### Prefix and behavior

set -g prefix C-Space
unbind C-b
bind-key C-Space send-prefix

set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -sg escape-time 0
set -g history-limit 50000
set -g mouse on
set -g aggressive-resize off
set -g set-titles off
set -g default-terminal "screen-256color"

### Vi mode and copy mode

setw -g mode-keys vi
set-window-option -g mode-keys vi

# Search 
bind-key -T copy-mode-vi / command-prompt -i -p "search down" \
  "send -X search-forward-incremental \"%%%\""
bind-key -T copy-mode-vi ? command-prompt -i -p "search up" \
  "send -X search-backward-incremental \"%%%\""

# Selection & yanking
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi y send -X copy-selection-and-cancel

### Splits and window managment

bind-key v split-window -h -c "#{pane_current_path}"
bind-key s split-window -v -c "#{pane_current_path}"

# Pane zoom
bind-key z resize-pane -Z

# Break pane into new window
bind-key b break-pane -d

# Quick pane kill 
bind-key X kill-pane


### Smart navigation (vim-aware)

# Is vim/nvim in current pane?
is_vim="ps -o comm= -t '#{pane_tty}' | grep -iqE 'g?(view|n?vim)(diff)?$'"

bind-key -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind-key -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

# Copy-mode navigation
bind-key -T copy-mode-vi C-h select-pane -L
bind-key -T copy-mode-vi C-j select-pane -D
bind-key -T copy-mode-vi C-k select-pane -U
bind-key -T copy-mode-vi C-l select-pane -R

### Resizing
bind-key -n M-h if-shell "$is_vim" "send-keys M-h" "resize-pane -L 5"
bind-key -n M-j if-shell "$is_vim" "send-keys M-j" "resize-pane -D 5"
bind-key -n M-k if-shell "$is_vim" "send-keys M-k" "resize-pane -U 5"
bind-key -n M-l if-shell "$is_vim" "send-keys M-l" "resize-pane -R 5"

bind-key -T copy-mode-vi M-h resize-pane -L 5
bind-key -T copy-mode-vi M-j resize-pane -D 5
bind-key -T copy-mode-vi M-k resize-pane -U 5
bind-key -T copy-mode-vi M-l resize-pane -R 5

### Pane and window movement

# Swap panes
bind-key -n M-H swap-pane -s '{left-of}'
bind-key -n M-L swap-pane -s '{right-of}'
bind-key -n M-K swap-pane -s '{up-of}'
bind-key -n M-J swap-pane -s '{down-of}'

# Move windows left/right
bind-key < swap-window -t -1 \; previous-window
bind-key > swap-window -t +1 \; next-window

### Session/tree view

unbind-key w
bind-key w choose-tree -Zs

bind-key C-j choose-tree

### Visuals
set -g status-style bg="#7e6297"
set -g window-status-format "#[fg=#94eeff]#I#[fg=#eee4ff]·#[fg=#94eeff]#W"
set -g window-status-current-format "#[fg=#ffffff,bold]#I#[fg=#eee4ff]·#[fg=#ffffff,bold]#W"
set -g pane-active-border-style "bg=default fg=#c59fff"

set -g mode-style "fg=#0c0a16,bg=#c59fff"

### Misc
setw -g monitor-activity on
set -g visual-activity off
set -g window-status-activity-style "fg=#ff6b6b"

bind-key r source-file ~/.config/tmux/tmux.conf \; display-message "tmux.conf reloaded."
